# 음성 통화 기능 사용 가이드

## 개요
채팅방에서 WebRTC를 사용하여 실시간 음성 통화를 할 수 있는 기능입니다. 가이드와 고객이 직접 음성으로 소통할 수 있습니다.

## 사용 방법

### 1. 통화 시작하기

**가이드 또는 고객:**
1. 채팅방 헤더 영역의 **녹색 전화 아이콘** 버튼 클릭
2. 브라우저에서 마이크 권한 요청 → **"허용"** 선택
3. 상대방에게 통화 요청이 전송됩니다
4. "통화 중..." 모달이 표시됩니다

### 2. 통화 수신하기

**상대방:**
1. 통화 요청이 오면 자동으로 **"통화 요청"** 모달이 표시됩니다
2. 모달에 상대방 이름이 표시됩니다
3. **녹색 수락 버튼** 또는 **빨간색 거절 버튼** 선택

### 3. 통화 중

**통화가 연결되면:**
- "통화 중" 상태로 변경됩니다
- 통화 시간이 표시됩니다
- **음소거 버튼** (마이크 아이콘)으로 음소거 on/off 가능
- **종료 버튼** (전화 끊기 아이콘)으로 통화 종료

### 4. 통화 종료하기

**어느 쪽이든:**
- **빨간색 종료 버튼** 클릭
- 통화가 즉시 종료되고 스트림이 정리됩니다

## UI 설명

### 통화 버튼 위치
- **데스크톱**: 채팅방 헤더 왼쪽 버튼 그룹 (녹색 전화 아이콘)
- **모바일**: 접기/펼치기 메뉴 내부

### 통화 모달 상태

1. **통화 중...** (calling)
   - 통화를 걸었을 때 표시
   - 상대방이 응답할 때까지 대기
   - 거절 버튼으로 취소 가능

2. **통화 요청** (ringing)
   - 상대방이 통화를 걸었을 때 표시
   - 수락 또는 거절 선택 가능

3. **통화 중** (connected)
   - 통화가 연결된 상태
   - 통화 시간 표시
   - 음소거 및 종료 버튼 사용 가능

## 기술 요구사항

### 브라우저 지원
- ✅ Chrome/Edge: 완전 지원
- ✅ Firefox: 완전 지원
- ✅ Safari: iOS 11+ 지원
- ✅ Opera: 완전 지원

### 필수 조건
- **HTTPS 연결** (로컬 개발은 localhost 허용)
- **마이크 권한** 필요
- **WebRTC 지원** 브라우저

### 네트워크
- 기본적으로 Google STUN 서버 사용
- 방화벽/NAT 환경에서도 대부분 작동
- 일부 엄격한 방화벽 환경에서는 TURN 서버 필요 (향후 추가 가능)

## 문제 해결

### 마이크 권한이 요청되지 않는 경우
1. 브라우저 설정에서 사이트 권한 확인
2. 주소창의 자물쇠 아이콘 클릭 → 마이크 권한 확인
3. 브라우저 재시작 후 다시 시도

### 통화가 연결되지 않는 경우
1. 브라우저 콘솔에서 오류 메시지 확인
2. 네트워크 연결 상태 확인
3. 방화벽 설정 확인
4. 다른 브라우저에서 시도

### 소리가 들리지 않는 경우
1. 시스템 볼륨 확인
2. 브라우저 탭이 음소거되어 있는지 확인
3. 다른 오디오 앱이 마이크를 사용 중인지 확인
4. 브라우저 재시작

### 통화가 자동으로 끊기는 경우
- 30초 내 응답이 없으면 자동 종료 (통화 요청 시)
- 네트워크 연결이 끊기면 자동 종료
- 브라우저 탭을 닫으면 자동 종료

## 보안 및 개인정보

- 통화는 P2P (Peer-to-Peer) 방식으로 직접 연결됩니다
- 서버를 통한 음성 데이터 전송 없음
- 통화 내용은 저장되지 않습니다
- 통화 기록은 저장되지 않습니다 (향후 추가 가능)

## 향후 개선 사항

- [ ] 통화 기록 저장
- [ ] 통화 녹음 기능
- [ ] 화상 통화 지원
- [ ] 그룹 통화 지원
- [ ] TURN 서버 설정
- [ ] 통화 품질 표시

