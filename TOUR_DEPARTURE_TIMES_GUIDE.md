# 투어 출발 시간 다중 선택 기능 사용 가이드

## 개요
상품에 여러 개의 출발 시간을 설정하여, 투어 생성 시 선택할 수 있도록 하는 기능입니다.

## 주요 기능
1. **다중 출발 시간 설정**: 하나의 상품에 여러 출발 시간 추가 가능
2. **시간 관리**: 시간 추가/제거 기능
3. **데이터 저장**: JSON 배열 형태로 데이터베이스에 저장
4. **투어에서 활용**: 투어 생성 시 해당 상품의 출발 시간 선택 가능

## 사용 방법

### 1. 상품 편집에서 출발 시간 추가
1. 상품 관리 → 상품 편집 → 기본정보 탭
2. "투어 출발 시간들" 섹션에서 시간 선택
3. "출발 시간 추가" 버튼 클릭
4. 반복하여 여러 시간 추가 가능

### 2. 출발 시간 제거
- 추가된 시간 태그 옆의 "×" 버튼 클릭

### 3. 투어에서 출발 시간 선택 (향후 구현 예정)
```sql
-- 특정 상품의 사용 가능한 출발 시간 조회
SELECT get_available_departure_times('상품ID');

-- 특정 시간이 유효한지 확인
SELECT is_valid_departure_time('상품ID', '09:00'::time);
```

## 데이터베이스 스키마

### 테이블 변경사항
- `products` 테이블에 `tour_departure_times` 컬럼 추가 (JSONB 타입)
- 형식: `["09:00", "14:00", "18:00"]`

### 추가된 함수들
1. `get_available_departure_times(product_id)` - 상품의 출발 시간 목록 반환
2. `is_valid_departure_time(product_id, time)` - 시간 유효성 검증

## 기술적 세부사항

### 프론트엔드
- React 상태 관리로 다중 시간 관리
- 실시간 UI 업데이트
- 다국어 지원 (한국어/영어)

### 백엔드
- PostgreSQL JSONB 타입 사용
- 인덱스 최적화 (GIN 인덱스)
- 제약조건으로 데이터 무결성 보장

### 보안
- 시간 형식 검증 (HH:MM)
- 최대 10개 시간 제한
- SQL 인젝션 방지

## 마이그레이션

### 기존 데이터 변환
```sql
-- 기존 단일 시간을 배열로 변환 (필요시)
UPDATE products 
SET tour_departure_times = CASE 
  WHEN tour_departure_time IS NOT NULL 
  THEN jsonb_build_array(tour_departure_time)
  ELSE '[]'::jsonb 
END;
```

## 예시 사용 사례

### 1. 반일 투어 (오전/오후)
```
오전 투어: ["09:00", "09:30"]
오후 투어: ["14:00", "14:30"]
```

### 2. 야간 투어
```
저녁 투어: ["18:00", "19:00", "20:00"]
```

### 3. 풀데이 투어
```
하루 투어: ["08:00"] (시간대 하나만 설정)
```

## 주의사항
1. 시간은 HH:MM 형식을 준수해야 합니다
2. 중복 시간은 추가되지 않습니다
3. 최대 10개까지 시간을 추가할 수 있습니다
4. 데이터베이스 마이그레이션 후 기능을 사용하세요

## 향후 계획
1. 투어 생성 시 상품별 출발 시간 선택 기능
2. 출발 시간별 가격 차등 적용
3. 예약 가능 여부 실시간 확인
4. 대시보드에서 출발 시간별 통계
